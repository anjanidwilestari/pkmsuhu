<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Forecast</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/3.6.95/css/materialdesignicons.css" />
    <style>
      .dashboard {
        background-image: url("https://images.pexels.com/photos/6746690/pexels-photo-6746690.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260");
        background-size: cover;
        background-repeat: no-repeat;
        height: 100vh;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      body {
        background-color: #f9f9fa;
        margin: 0;
        padding: 0;
        height: 100vh;
        overflow: hidden;
      }

      .card {
        border: 0;
        border-radius: 2px;
        background: #e1ecff;
        background-image: linear-gradient(to left bottom, #ffecd2, #ffdbb5, #ffc898, #ffb679, #ffa25b);
        width: 90%;
        height: 90%;
        display: flex;
        flex-direction: column;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .card-body {
        flex: 1;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
      }

      .weather-date-location {
        margin-bottom: 1rem;
      }

      .display-3 {
        font-size: 3rem;
      }

      .weakly-weather {
        display: flex;
        overflow-x: auto;
        background: #fff;
        border-top: 1px solid #f2f2f2;
        padding: 1rem;
        margin-top: auto;
      }

      .weakly-weather-item {
        flex: 1;
        text-align: center;
      }

      .weakly-weather-item img {
        width: 2rem;
        height: 2rem;
      }

      @media (max-width: 991.98px) {
        .display-3 {
          font-size: 2rem;
        }

        .weakly-weather-item p {
          font-size: 0.875rem;
        }

        .weakly-weather-item img {
          width: 1.5rem;
          height: 1.5rem;
        }
      }

      @media (max-width: 767.98px) {
        .display-3 {
          font-size: 1.5rem;
        }

        .weakly-weather-item p {
          font-size: 0.75rem;
        }

        .weakly-weather-item img {
          width: 1.25rem;
          height: 1.25rem;
        }
      }
    </style>
  </head>
  <body>
    <section class="dashboard">
      <div class="card card-weather">
        <div class="card-body">
          <div class="weather-date-location">
            <h3 id="current-day">Friday</h3>
            <p class="text-gray">
              <span class="weather-date" id="current-date">25 March, 2019</span>
              <span class="weather-location" id="current-location">Sydney, Australia</span>
            </p>
          </div>
          <div class="weather-data d-flex">
            <div class="mr-auto">
              <h4 class="display-3">
                <span id="current-temperature">32</span>
                <span class="symbol">&deg;</span>C
              </h4>
              <p id="current-weather">Cloudy</p>
            </div>
          </div>
          <div class="weakly-weather" id="forecast">
            <!-- Forecast items will be appended here dynamically -->
          </div>
        </div>
      </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
      window.onload = function () {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition((position) => {
            fetch("/location", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
              }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.status === "success") {
                  // Update current weather
                  const currentDate = new Date(data.current.date * 1000);
                  const options = {
                    weekday: "long",
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                    hour: "numeric",
                    minute: "numeric",
                    hour12: true,
                  };
                  const formattedDate = currentDate.toLocaleDateString("en-US", options);
                  const [datePart, timePart] = formattedDate.split(" at ");
                  document.getElementById("current-day").textContent = datePart;
                  document.getElementById("current-date").textContent = timePart;
                  document.getElementById("current-location").textContent = `${data.current.location}`;
                  document.getElementById("current-temperature").textContent = data.current.temperature;
                  document.getElementById("current-weather").textContent = `${data.current.weather} - ${data.current.description}`;

                  // Update 5-day forecast
                  const forecastContainer = document.getElementById("forecast");
                  forecastContainer.innerHTML = "";
                  for (let i = 0; i < data.forecasts.length; i++) {
                    const forecast = data.forecasts[i];
                    const forecastDate = new Date(forecast.date * 1000);
                    const forecastItem = document.createElement("div");
                    forecastItem.className = "weakly-weather-item";
                    forecastItem.innerHTML = `
                                    <p class="mb-0">${forecastDate.toLocaleDateString("en-US", { weekday: "short" })}</p>
                                    <img src="http://openweathermap.org/img/wn/${forecast.icon}.png" alt="Weather Icon">
                                    <p class="mb-0">${forecast.temperature}&deg;C</p>
                                `;
                    forecastContainer.appendChild(forecastItem);
                  }
                } else {
                  alert(data.message);
                }
              })
              .catch((error) => console.error("Error:", error));
          });
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      };
    </script>
  </body>
</html>
