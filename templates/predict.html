<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Weather Forecast</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/MaterialDesign-Webfont/3.6.95/css/materialdesignicons.css" />
    <style>
      .dashboard {
        background-image: url("https://images.pexels.com/photos/6746690/pexels-photo-6746690.jpeg?auto=compress&cs=tinysrgb&dpr=2&h=750&w=1260");
        background-size: cover;
        background-repeat: no-repeat;
        min-height: 100vh; /* Use min-height instead of height */
        display: flex;
        justify-content: center;
        align-items: flex-start; /* Align items to the start */
        overflow-y: auto; /* Allow vertical scrolling */
      }

      body {
        background-color: #f9f9fa;
        margin: 0;
        padding: 0;
        min-height: 100vh; /* Use min-height instead of height */
        overflow-y: auto; /* Allow vertical scrolling */
      }

      .card {
        border: 0;
        border-radius: 2px;
        background: #e1ecff;
        background-image: linear-gradient(to left bottom, #ffecd2, #ffdbb5, #ffc898, #ffb679, #ffa25b);
        width: 90%;
        margin-top: 20px; /* Add some margin to the top */
        display: flex;
        flex-direction: column;
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
      }

      .card-body {
        flex: 1;
        padding: 1.5rem;
        display: flex;
        flex-direction: column;
        overflow-y: auto; /* Allow vertical scrolling */
      }

      .weather-date-location {
        margin-bottom: 1rem;
      }

      .display-3 {
        font-size: 3rem;
      }

      .weather-data {
        display: flex;
        margin-bottom: 1rem;
      }

      .plant-care-info {
        margin-bottom: 1rem;
      }

      .weakly-weather {
        display: flex;
        flex-direction: column;
        background: #fff;
        border-top: 1px solid #f2f2f2;
        padding: 1rem;
        margin-top: auto;
        overflow-y: auto; /* Allow vertical scrolling */
      }

      .daily-forecast {
        margin-bottom: 1rem;
      }

      .forecast-title {
        font-weight: bold;
        margin-bottom: 0.5rem;
      }

      .hourly-weather {
        display: flex;
        overflow-x: auto; /* Allow horizontal scrolling */
      }

      .hourly-weather-item {
        flex: 1;
        text-align: center;
        margin-right: 0.5rem;
      }

      .hourly-weather-item img {
        width: 2rem;
        height: 2rem;
      }

      @media (max-width: 991.98px) {
        .display-3 {
          font-size: 2rem;
        }

        .hourly-weather-item p {
          font-size: 0.875rem;
        }

        .hourly-weather-item img {
          width: 1.5rem;
          height: 1.5rem;
        }
      }

      @media (max-width: 767.98px) {
        .display-3 {
          font-size: 1.5rem;
        }

        .hourly-weather-item p {
          font-size: 0.75rem;
        }

        .hourly-weather-item img {
          width: 1.25rem;
          height: 1.25rem;
        }
      }
    </style>
  </head>
  <body>
    <section class="dashboard">
      <div class="card card-weather">
        <div class="card-body">
          <!-- Left side: Weather information -->
          <div class="weather-date-location">
            <h3 id="current-day">Friday</h3>
            <p class="text-gray">
              <span class="weather-date" id="current-date">25 March, 2019</span>
              <span class="weather-location" id="current-location">Sydney, Australia</span>
            </p>
          </div>
          <div class="weather-data d-flex">
            <div class="mr-auto">
              <h4 class="display-3">
                <span id="current-temperature">32</span>
                <span class="symbol">&deg;</span>C
              </h4>
              <p id="current-weather">Cloudy</p>
            </div>
          </div>
          <!-- Right side: Plant care information -->
          <div class="plant-care-info">
            <h3>Plant Care Information</h3>
            <div id="plant-care-info">
              <!-- Plant care information will be appended here dynamically -->
            </div>
          </div>
          <div class="weakly-weather" id="forecast">
            <!-- Forecast items will be appended here dynamically -->
          </div>
        </div>
      </div>
    </section>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script>
      window.onload = function () {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition((position) => {
            fetch("/location", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify({
                latitude: position.coords.latitude,
                longitude: position.coords.longitude,
              }),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.status === "success") {
                  // Update current weather
                  const currentDate = new Date(data.current.date * 1000);
                  const options = {
                    weekday: "long",
                    year: "numeric",
                    month: "long",
                    day: "numeric",
                    hour: "numeric",
                    minute: "numeric",
                    hour12: true,
                  };
                  const formattedDate = currentDate.toLocaleDateString("en-US", options);
                  const [datePart, timePart] = formattedDate.split(" at ");
                  document.getElementById("current-day").textContent = datePart;
                  document.getElementById("current-date").textContent = timePart;
                  document.getElementById("current-location").textContent = `${data.current.location}`;
                  document.getElementById("current-temperature").textContent = data.current.temperature;
                  document.getElementById("current-weather").textContent = `${data.current.weather} - ${data.current.description}`;

                  // Update plant care information
                  const plantCareInfoContainer = document.getElementById("plant-care-info");
                  const plantCareInfo = data.plant_care_info;
                  const plantCareInfoHtml = `
                            <p>${plantCareInfo.category}</p>
                            <ul>
                                ${plantCareInfo.info.map((info) => `<li>${info}</li>`).join("")}
                            </ul>
                        `;
                  plantCareInfoContainer.innerHTML = plantCareInfoHtml;

                  // Update 5-day forecast with 3-hour intervals
                  const forecastContainer = document.getElementById("forecast");
                  forecastContainer.innerHTML = "";
                  for (let date in data.forecasts) {
                    const dailyForecasts = data.forecasts[date];
                    const dailyForecastContainer = document.createElement("div");
                    dailyForecastContainer.className = "daily-forecast";
                    dailyForecastContainer.innerHTML = `<div class="forecast-title">${new Date(dailyForecasts[0].time * 1000).toLocaleDateString("en-US", { weekday: "long", year: "numeric", month: "long", day: "numeric" })}</div>`;
                    const hourlyWeatherContainer = document.createElement("div");
                    hourlyWeatherContainer.className = "hourly-weather";
                    dailyForecasts.forEach((forecast) => {
                      const forecastDate = new Date(forecast.time * 1000);
                      const forecastItem = document.createElement("div");
                      forecastItem.className = "hourly-weather-item";
                      forecastItem.innerHTML = `
                                    <p class="mb-0">${forecastDate.getHours()}:00</p>
                                    <img src="http://openweathermap.org/img/wn/${forecast.icon}.png" alt="Weather Icon">
                                    <p class="mb-0">${forecast.temperature}&deg;C</p>
                                `;
                      hourlyWeatherContainer.appendChild(forecastItem);
                    });
                    dailyForecastContainer.appendChild(hourlyWeatherContainer);
                    forecastContainer.appendChild(dailyForecastContainer);
                  }
                } else {
                  alert(data.message);
                }
              })
              .catch((error) => console.error("Error:", error));
          });
        } else {
          alert("Geolocation is not supported by this browser.");
        }
      };
    </script>
  </body>
</html>
